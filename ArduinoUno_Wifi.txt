#include <Servo.h>
Servo myservo;

const int Trig = 12;
const int Echo = 13;

#define PWM1_PIN            5
#define PWM2_PIN            6
#define SHCP_PIN            2
#define EN_PIN              7
#define DATA_PIN            8
#define STCP_PIN            4

const int Forward       = 92;
const int Backward      = 163;
const int Turn_Left     = 149;
const int Turn_Right    = 106;
const int Stop_Movement = 0;

void setup() {
    myservo.attach(9, 700, 2400);
    pinMode(Trig, OUTPUT);
    pinMode(Echo, INPUT);

    pinMode(SHCP_PIN, OUTPUT);
    pinMode(EN_PIN, OUTPUT);
    pinMode(DATA_PIN, OUTPUT);
    pinMode(STCP_PIN, OUTPUT);
    pinMode(PWM1_PIN, OUTPUT);
    pinMode(PWM2_PIN, OUTPUT);
    Serial.begin(115200);
}

void loop() {
    if (Serial.available() > 0) {
        char command = Serial.read();
        switch (command) {
            case 'F':
                Motor(Forward, 250); // Adelante
                break;
            case 'B':
                Motor(Backward, 250); // Atr√°s
                break;
            case 'L':
                Motor(Turn_Left, 250); // Izquierda
                break;
            case 'R':
                Motor(Turn_Right, 250); // Derecha
                break;
            case 'S':
                Motor(Stop_Movement, 0); // Detener
                break;
            default:
                Motor(Stop_Movement, 0); // Comando desconocido, detener por seguridad
                break;
        }
    }
}

void Motor(int Dir, int Speed) {
    analogWrite(PWM1_PIN, Speed);
    analogWrite(PWM2_PIN, Speed);

    digitalWrite(STCP_PIN, LOW);
    shiftOut(DATA_PIN, SHCP_PIN, MSBFIRST, Dir);
    digitalWrite(STCP_PIN, HIGH);
}
